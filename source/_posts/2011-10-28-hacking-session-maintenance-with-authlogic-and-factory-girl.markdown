--- 
layout: post
title: Hacking session maintenance with Authlogic and Factory Girl
typo_id: 53
comments: true
---

I use [Authlogic](https://github.com/binarylogic/authlogic) to provide 
authentication for a couple Rails projects.  I also use [Factory Girl](https://github.com/thoughtbot/factory_girl)
as a fixtures replacement.

When FG creates a User for you, a new UserSession automatically gets created.
This is by virtue of Authlogic's automatic session maintenance, which 
can be pretty handy.  However, in my tests I want complete control over 
the UserSession.  Just because I created a new user, doesn't mean I want
that user logged in.  In many cases, I _don't_ want the user to be 
logged in, and this behavior was causing my tests to fail.

To work around this behaviour, I ended up adding this to my User factory:

``` ruby
after_create do |u|
  u.class.maintain_sessions = false
end
```

That quashed the autogenerated UserSession.  There might be a cleaner method somewhere, but so far this is doing the trick for me.
