--- 
layout: post
title: Missing foreign key constraints in Rails test database
typo_id: 3
---
<p>
	Wondering why your foreign key constraints are never created in your Rails test database? Chances are you, like me, are creating your referential integrity constraints using execute calls in a migration. These database-implementation-specific statements cannot be included in the DB-independent schema.rb file, so when you run<code> rake test:db:prepare</code> (or it is called implicitly by <code>rake test:functionals</code>), your FK constraints are not included in the test database.</p>
<p>
	The workaround to this is simple. In your environment.rb file, add (or uncomment) a line as follows:</p>
<p>
	<code>config.active_record.schema_format = :sql</code></p>
<p>
	Now Rails will load the test DB structure from db/development_structure.rb, which should be automatically created when you run your tests. You can also create it manually using <code>rake db:structure:dump</code>.</p>
